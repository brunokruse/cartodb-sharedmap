{"name":"Cartodb-sharedmap","tagline":"Based off example on: http://bl.ocks.org/matallo/130b969a6cc76939985d","body":"<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Easy example | CartoDB.js</title>\r\n    <meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=no\" />\r\n    <meta http-equiv=\"content-type\" content=\"text/html; charset=UTF-8\"/>\r\n    <link rel=\"shortcut icon\" href=\"http://cartodb.com/assets/favicon.ico\" />\r\n    <style>\r\n      html, body, #map {\r\n        height: 100%;\r\n        padding: 0;\r\n        margin: 0;\r\n      }\r\n    </style>\r\n\r\n    <link rel=\"stylesheet\" href=\"http://libs.cartocdn.com/cartodb.js/v3/3.11/themes/css/cartodb.css\" />\r\n    <link rel=\"stylesheet\" href=\"http://leaflet.github.io/Leaflet.draw/leaflet.draw.css\" />\r\n\r\n  </head>\r\n  <body>\r\n    <div id=\"map\"></div>\r\n\r\n    <!-- include cartodb.js library -->\r\n    <script src=\"http://libs.cartocdn.com/cartodb.js/v3/3.11/cartodb.js\"></script>\r\n    <script src=\"http://leaflet.github.io/Leaflet.draw/leaflet.draw.js\"></script>\r\n\r\n  <script>\r\n    var map = new L.Map('map', {\r\n      zoomControl: false,\r\n      center: [43, 0],\r\n      zoom: 3\r\n    });\r\n\r\n    var layer = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png',{\r\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>'\r\n    });\r\n    map.addLayer(layer);\r\n\r\n    var drawControl = new L.Control.Draw({\r\n      position: 'topright',\r\n      draw: {\r\n        polyline: true,\r\n        polygon: false,\r\n        rectangle: false,\r\n        circle: false,\r\n        marker: false\r\n      }\r\n    });\r\n    map.addControl(drawControl);\r\n\r\n    cartodb.createLayer(map, 'https://brunokruse.cartodb.com/api/v2/viz/f6fea1cc-bc8f-11e4-af63-0e9d821ea90d/viz.json')\r\n      .addTo(map)\r\n      .on('done', function(layer) {\r\n        // Keep track of all draw objects\r\n        var drawnItems = new L.FeatureGroup();\r\n        map.addLayer(drawnItems);\r\n\r\n        map.on('draw:created', function (e) {\r\n          var type = e.layerType,\r\n            draw_layer = e.layer;\r\n\r\n          // Show the polygon on the map\r\n          drawnItems.addLayer(draw_layer);\r\n\r\n          // Get the coordinates of the polygon we just drew\r\n          var poly = draw_layer.getLatLngs();\r\n          var sql_poly = [];\r\n          for (i in poly){\r\n            sql_poly.push(\"CDB_LatLng(\"+poly[i].lat+\",\"+poly[i].lng+\")\")\r\n          }\r\n\r\n          var line = \"ST_MakeLine(Array[\"+sql_poly.join()+\"])\";\r\n          var username = prompt(\"Please enter your name\");\r\n\r\n          if (username != null) {\r\n            var sql = \"INSERT INTO leaflet_data (username, the_geom) VALUES ('\"+username+\"', ST_SetSRID(ST_AsText(\"+line+\"),4326))&api_key=YOUR_API_KEY\";\r\n\r\n            $.ajax({\r\n              url: 'https://matallo.cartodb.com/api/v2/sql?q='+sql,\r\n              success: function(responseData, textStatus, jqXHR) {\r\n                console.log(\"Data saved\");\r\n              },\r\n              error: function (responseData, textStatus, errorThrown) {\r\n                console.log(\"Problem saving the data\");\r\n              }\r\n            });\r\n          }\r\n        });\r\n      });\r\n  </script>\r\n</body>\r\n</html>","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}